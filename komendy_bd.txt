1.List
CREATE TABLE postac(
id_postaci int AUTO_INCREMENT,
nazwa varchar(40),
rodzaj enum('wiking','ptak',kobieta'),
data_ur date,
wiek int UNSIGNED,
PRIMARY KEY(id_postaci)
);

INSERT INTO postac (id_postaci,nazwa,rodzaj,data_ur,wiek) VALUES (
'1','Bjorn','wiking','1887-09-04','45',
'2','Drozd','ptak','2001-12-24','4',
'3','Tesciowa','kobieta','1990-02-14','67'
);

UPDATE postac wiek=88 WHERE nazwa='Tesciowa';


2. Panika
CREATE TABLE walizka (
id_walizki int AUTO_INCREMENT,
pojemnosc int UNSIGNED,
kolor enum('rozowy','czerwony','teczowy','zolty'),
id_wlasciciela int,
PRIMARY KEY (id_walizki),
FOREIGN KEY (id_wlasciciela) REFERENCES postac(id_postaci) ON DELETE CASCADE
);

ALTER TABLE walizka ALTER kolor SET DEFAULT 'rozowy';

INSERT INTO walizka(id_walizki,pojemnosc,kolor,id_wlasciciela) VALUES (
'1','85','teczowy','1',
'2','50','','3'
);


3.Niespodzianka
CREATE TABLE izba (
adres_budynku varchar (40),
nazwa_izby varchar(40),
metraz int UNSIGNED,
wlasciciel int,
PRIMARY KEY(adres_budynku,nazwa_izby),
FOREIGN KEY(wlasciciel) REFERENCES postac(id_postaci) ON DELETE SET NULL
);

ALTER TABLE izba ADD kolor_izby varchar(10) default 'czarny' AFTER metraz;

INSERT INTO izba(adres_budynku,nazwa_izby,metraz,kolor_izby,wlasciciel) VALUES (
'Srebrna 3','spizarnia','35','czerwony','3'
);

4.Koszmar
CREATE TABLE przetwory (
id_przetworu int,
rok_produkcji int(4) default 1654,
id_wykonawcy int,
zawartosc varchar(50),
dodatek varchar(50) default 'papryczka chili',
id_konsumenta int,
PRIMARY KEY(id_przetworu),
FOREIGN KEY(id_wykonawcy) REFERENCES postac(id_postaci),
FOREIGN KEY(id_konsumenta) REFERENCES postac(id_postaci)
);

INSERT INTO przetwory(id_przetworu,rok_produkcji,id_wykonawcy,zawartosc,dodatek,id_konsumenta) VALUES(
'1','1654','3','bigos','papryczka chili','1'
);


5.Ucieczka
INSERT INTO postac(id_postaci,nazwa,rodzaj,data_ur,wiek) VALUES 
('4','Alfarin','wiking','1884-11-1','23'),
('5','Baeng','wiking','1882-05-9','55'),
('6','Geitir','wiking','1875-11-11','18'),
('7','Haklang','wiking','1898-07-31','37'),
('8','Ingegard','wiking','1745-10-13','29');

CREATE TABLE statek(
nazwa_statku varchar(20),
rodzaj_statku enum('handlowy','wojskowy'),
data_wodowania date,
max_ladownosc int UNSIGNED,
PRIMARY KEY(nazwa_statku)
);

INSERT INTO statek VALUES
('Godzilla','wojskowy','1755-05-11','5000'),
('Ramer','handlowy','1881-07-1','13214121');

ALTER TABLE postac ADD funkcja varchar(20);

UPDATE postac SET funkcja='kapitan' WHERE nazwa='Bjorn';

ALTER TABLE postac ADD nazwa_statku varchar(20);
ALTER TABLE postac ADD FOREIGN KEY(nazwa_statku) REFERENCES statek(nazwa_statku);

UPDATE postac SET nazwa_statku='Godzilla' where id_postaci=(1,3,5,6);

DROP TABLE izba;

DELETE FROM izba WHERE nazwa_izby='spizarnia';

6.Cicha woda
SELECT * FROM postac order by data_ur desc limit 2;
DELETE FROM postac WHERE id='2';

WYŁĄCZENIE SPRAWDZANIE POPRAWNOŚCI KLUCZY OBCYCH:
SET foreign_key_checks =0;

USUWANIE KLUCZA GŁÓWNEGO:
ALTER TABLE tabela z references do tabeli gdzie chcemy usunac klucz gł DROP FOREIGN KEY ..._ibfk_...;
ALTER TABLE przetwory DROP FOREIGN KEY przetwory_ibfk_1;

USUWANIE AI:
ALTER TABLE postac MODIFY id_postaci int;

ALTER TABLE postac DROP primary key;

ALTER TABLE postac ADD pesel varchar(11) PRIMARY KEY;

ALTER TABLE postac MODIFY rodzaj ENUM('wiking','ptak','kobieta','syrena');

GROUP BY - grupowanie

SUM- sumowanie
AVG - średnia arytmetyczna
MAX - maximum
MIN - minimum
COUNT - zlicza ilość zwróconych wierszy
DISTINCT - unikalne wartości w kolumnie

SELECT rodzaj, sum(udzwig) from kreatura GROUP BY rodzaj;
SELECT count(*) from kreatura;
SELECT count(distinct rodzaj) from kreatura;
SELECT avg(waga) from kreatura where rodzaj = wiking;
SELECT rodzaj, count(rodzaj) avg(waga) from kreatura group by rodzaj;
SELECT rodzaj, avg(year(now()) - year(dataUr))from kreatura group by rodzaj;

Lab06
Zad.4
SELECT * FROM kreatura k inner join kretura k2 on k.idKreatury!=k2.idKreatury;
SELECT * FROM kreatura k inner join ekwipunek e on k.idKreatury=e.idKreatury inner join zasob z on e.idZasobu=z.idZasobu where z.rodzaj='jedzenie' order by k.dataUr desc limit 5;

Zad.5
a)
SELECT k.rodzaj, avg(e.ilosc*z.waga) FROM kreatura k inner join ekwipunek e on k.idKreatury=e.idKreatury inner join zsob z on e.idZasobu=z.idZasobu where k.rodzaj not in('waz','malpa') group by k.rodzaj having sum(e.ilosc)<30;
b)
SELECT k.nazwa, k.rodzaj, k.dataUr from kreatura k, (select rodzaj, min(dataUr) as min, max(dataUr) as max from kreatura group by rodzaj) as pod where k.dataUr = pod.min or k.dataUr=pod.max and k.rodzaj=pod.rodzaj;

Lab07
Zad.1
a)
INSERT INTO kreatura SELECT * FROM wikingowie.kreatura;
b)
SELECT nazwa FROM kreatura k inner join uczestnicy u on k.idKreatury=u.id_uczestnika where 
c)
SELECT w.nazwa, SUM(e.ilosc) FROM wyprawa w inner join uczestnicy u on w.id_wyprawy=u.id_wyprawy inner join kreatura k on u.id_uczestnika=k.idKreatury inner join ekwipunek e on k.idKreatury=e.idKreatury GROUP BY w.nazwa;

Zad.2
a)
SELECT w.nazwa, count(u.id_uczestnika), group_concat(k.nazwa separator '|') FROM wyprawa w inner join uczestnicy u on w.id_wyprawy=u.id_wyprawy inner join kreatura k on u.id_uczestnika=k.idKreatury GROUP BY w.nazwa;
b)
SELECT e.idEtapu, e.idWyprawy, s.nazwa, k.nazwa FROM etapy_wyprawy e inner join sektor s on e.sektor=s.id_sektora inner join wyprawa w on e.idWyprawy=w.id_wyprawy inner join kreatura k on w.kierownik=k.idKreatury ORDER BY w.data_rozpoczecia, e.idEtapu;

Zad.3
a)
SELECT s.nazwa, count(s.id_sektora) FROM sektor s left join etapy_wyprawy ew on s.id_sektora=ew.sektor GROUP BY s.nazwa;
b)
SELECT k.nazwa, if(count(u.id_uczestnika)>0, 'bral udzialu w wyprawie','nie bral udzialu w wyprawie') FROM kreatura k left join uczestnicy u on k.idKreatury=u.id_uczestnika GROUP BY k.nazwa;

Zad.4
a)
SELECT w.nazwa, sum(length(ew.dziennik)) FROM wyprawa w inner join etapy_wyprawy ew on w.id_wyprawy=ew.idWyprawy GROUP BY w.nazwa having sum(length(ew.dziennik)) <400;
b)
SELECT w.nazwa, sum(e.ilosc*z.waga) / count(distinct u.id_uczestnika) from uczestnicy u left join wyprawa w on w.id_wyprawy=u.id_wyprawy left join kreatura k on k.idKreatury=u.id_uczestnika left join ekwipunek e on e.idKreatury=k.idKreatury left join zasob z on z.idZasobu=e.idZasobu group by w.id_wyprawy;

ZTI_BAZY
Zad.1
1)select nazwisko from pracownik order by nazwisko ASC;
2)select imie, nazwisko, pensja from pracownik where data_urodzenia > 1979;
3)select * from pracownik where pensja between 3500 and 5000;
4)select * from stan_magazynowy where ilosc >10;
5)select * from towar where nazwa_towaru like 'A%' or 'B%' or 'C%';
6)select * from klient where czy_firma =0;
7)select * from zamowienie order by data_zamowienia DESC limit 5;
8)select * from pracownik order by pensja asc limit 5;
9)
